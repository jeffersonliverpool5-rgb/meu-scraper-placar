name: Scraper Live ESPN

on:
  schedule:
    - cron: '*/5 * * * *' # Roda a cada 5 minutos
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do código
        uses: actions/checkout@v3

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Instalar Dependências
        run: |
          pip install selenium webdriver-manager

      - name: Executar Scraper
        run: python scraper.py

      - name: Filtro de Limpeza Real
        run: |
          # 1. Pega o topo do arquivo gerado pelo seu Python
          head -n 80 placares.txt > topo.txt
          
          # 2. LIMPEZA PESADA:
          # Remove linhas que tenham "PTS", "Estatísticas", "ATA", "ATH", "," ou frases longas
          grep -vE "PTS|Estatísticas|ATA|ATH|,|falta|sofre|campo|Minuto|vencendo|posse" topo.txt > sem_lixo.txt
          
          # 3. FILTRA APENAS O QUE IMPORTA:
          # Pega as linhas com os nomes dos times (Galatasaray/Atl Madrid)
          # Pega o minuto do jogo (ex: 41')
          # Pega números sozinhos de 0 a 9 (que é onde fica o placar na ESPN)
          grep -Ei "Galatasaray|Atl|Madrid|'|HT|FIM|^[0-9]$|^[0-9] - [0-9]$" sem_lixo.txt > final.txt
          
          # 4. Salva o resultado
          if [ ! -s final.txt ]; then
            echo "Aguardando placar real..." > placares.txt
          else
            # Remove linhas duplicadas e salva
            uniq final.txt > placares.txt
          fi

      - name: Salvar no GitHub
        run: |
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "action@github.com"
          git add placares.txt
          git commit -m "Placar Real: $(date +'%H:%M')" || exit 0
          git push
